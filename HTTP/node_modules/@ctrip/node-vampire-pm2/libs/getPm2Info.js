var fs = require('fs');
var spawnSync = require('child_process').spawnSync;

var name = process.argv[2] || '';

if (!name){
	process.stdout.write(JSON.stringify({
		code: 1,
		message: 'Invalid Name'
	}), function () {
		process.exit(1);
	});
}

var pm2 = null;
try {
	pm2 = require('pm2');
} catch (e){};

if (!pm2){
	var proc = spawnSync('npm', ['root', '-g']);
	if (!proc.status && !proc.stderr.length){
		var globalModulePath = proc.stdout.toString().trim();
		var stat = null;
		try {
			stat = fs.statSync(globalModulePath);
		} catch (e) {};
		if (stat && stat.isDirectory() && module.paths.indexOf(globalModulePath) == -1){
			module.paths.push(globalModulePath);
			try {
				pm2 = require('pm2');
			} catch (e) {};
		}
	}
}

if (pm2 && pm2.describe){
	pm2.describe(name, function (err, desc) {
		if (err){
			process.stdout.write(JSON.stringify({
				code: 1,
				message: '' + err
			}), function () {
				process.exit(1);
			});
		} else {
			process.stdout.write(JSON.stringify({
				code: 0,
				data: desc
			}), function () {
				process.exit(0);
			});
		}
	});
} else {
	process.stdout.write(JSON.stringify({
		code: 1,
		message: 'Invalid PM2'
	}), function () {
		process.exit(1);
	});
}