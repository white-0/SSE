## QConfig 模块 ##

### 简介 ###

- [QConfig基本原理](http://conf.ctripcorp.com/display/FRAM/CAT)
- [Qconfig配置中心](http://qconfig.ctripcorp.com/webapp/page/#/qconfig)

[第一版](http://npm.release.ctripcorp.com/package/@ctrip/qconfig-client)和[第二版](http://npm.release.ctripcorp.com/package/@ctrip/node-vampire-qconfig) nodeJs QConfig 客户端对比：

|                      |@ctrip/qconfig-client     |@ctrip/node-vampire-qconfig    |
|:---------------------|:------------------------:|:-----------------------------:|
|特性                  |单例、进程通信            |共享内存                       |
|应用中调用            |受限                      |√                              |
|模块中调用            |受限                      |√                              |
|应用/模块中均调用     |×                         |√                              |

::: tip
截止 2019/9/24 新版 `QConfig` 未接入 `ctirputil` 模块中，需独立安装 `@ctrip/node-vampire-qconfig`，建议应用中接入新版的 `QConfig`
:::

### 第二版Qconfig使用 ###

``` js
const qconfig = require('@ctrip/node-vampire-qconfig');
```

### qconfig.getConfig(configFileName[, defaultConfig]) ###

获取配置，从服务端拉取相应的配置文件，并开启长轮询获取最新配置

- `configFileName` [\<string\>](###) 文件名，格式为：`appID：fileName`，当传入的文件名不包含 `appID` 时，默认为当前 `appID` 下文件
- `defaultConfig` [\<string\>](###) 默认配置文件内容
- Returns: [\<QconfigObject\>](#class-qconfigobject)

### Class: QconfigObject ###

### qconfigObject.getSync([param]) ###

- `param` [\<string\>](###) 配置文件的某个 `key`，默认返回全部配置

- Returns: [\<string\>](###) | [\<Object\>](###)  返回对应的配置文件内容

::: tip
getSync 为同步方法，若调用此方法时，获取配置的异步请求未完成，则返回默认配置defaultConfig
:::

### qconfigObject.get([param]) ###

- `param` [\<string\>](###) 配置文件的某个 `key`，默认返回全部配置

- Returns: [\<Promise\>](###)

::: tip
get 为异步方法，等待从服务端获取配置之后返回
:::

### qconfigObject.on('change',callback) ###

- `callback` [\<Function\>](###) 回调函数
- Returns [\<Object\>](###) 返回配置文件的最新内容

代码样例 - properties 类型文件，指定默认配置:

``` js
let qconfig = require('@ctrip/node-vampire-qconfig');
let _qconfig = qconfig.getConfig('100018233:config.properties', 'test1=test01\ntest2=test02\n');

//同步获取文件内容
let _getSync = _qconfig.getSync(); //或：_qconfig.getSync('test2')

//或异步获取文件内容
let datas = _qconfig.get().then((data) => {
    console.log('QConfig Datas:', JSON.stringify(data))
}).catch((err) => {
    console.log('QConfig Error:', err);
});

_qconfig.on('change', (data) => {
    console.log('QConfig Change:', data);
});
```

代码样例 - json 类型文件,指定默认配置:

``` js
let qconfig = require('@ctrip/node-vampire-qconfig');
let _json = {
    open: true
};
let _qconfig = qconfig.getConfig('100018233:config.json', JSON.stringify(_json));

//同步获取文件内容
let _getSync = _qconfig.getSync() //或：_qconfig.getSync('test2')

//或异步获取文件内容
let datas = _qconfig.get().then((data) => {
    console.log('QConfig Datas:', JSON.stringify(data))
}).catch((err) => {
    console.log('QConfig Error:', err);
});

_qconfig.on('change', (data) => {
    console.log('QConfig Change:', data);
});
```
