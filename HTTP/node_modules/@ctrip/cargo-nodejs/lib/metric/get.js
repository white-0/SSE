'use strict'
const { sendMetric, now } = require('./metric')

/**
 * metric on get
 * @decorator
 * @param {CacheManger} cache object
 * @return {Function} metric decorator on method cache.get*
 */
module.exports = (object) => (fn) => (...args) => {
  const operationName = fn.name
  const params = JSON.stringify(args)
  const pes = `cargo.${operationName}(${params})`
  const key = ''
  const startTime = now()
  const result = fn.call(object, ...args)
  const elapsedTime = now() - startTime
  const status = result === '' ? 'no_hit' : 'hit'
  sendMetric(
    operationName,
    key,
    status,
    elapsedTime,
    result,
    params,
    pes
  )
  return result
}
