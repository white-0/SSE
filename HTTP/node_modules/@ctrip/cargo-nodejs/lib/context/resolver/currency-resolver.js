'use strict'
const Resolver = require('./resolver')
const { DEFAULT_CURRENCY } = require('../context-config')
const { QueryBuilder } = require('../../query')
const { INTERNAL_BOOLEAN_KEYS } = require('../../common/constants')
const cacheManager = require('../../cache')
const { CURRENCY_SWITCH, TOP_CURRENCY } = INTERNAL_BOOLEAN_KEYS

class CurrencyResolver extends Resolver {
  getGlobalDefault () {
    return DEFAULT_CURRENCY
  }

  getSupportedValues () {
    return new QueryBuilder(CURRENCY_SWITCH)
      .system()
      .queryList()
      .filter(item => item.value !== '0')
      .map(item => {
        const currency = cacheManager.getCurrencyById(item.currencyId)
        return currency && currency.name
      })
      .filter(Boolean)
  }

  getRecommendValues () {
    return new QueryBuilder(TOP_CURRENCY)
      .system()
      .group(this.groupName)
      .site(this.siteName)
      .queryList()
      .map(item => {
        const currency = cacheManager.getCurrencyById(item.currencyId)
        return currency && currency.name
      })
      .filter(Boolean)
  }
}

module.exports = CurrencyResolver
