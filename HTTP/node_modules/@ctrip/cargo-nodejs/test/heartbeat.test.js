'use strict'
const assert = require('assert')
const HeartBeatStore = require('../lib/collector/heart-beat-store')

describe('heartbeat collector test', () => {
  const store = new HeartBeatStore('appId', 'sdkVersion', 1000, 'sdkType')

  it('test for add data', () => {
    store.add('1', '1')
    store.add('1', '1')
    store.add('1', '1')
    store.add('2', '2')
    store.add('2', '2')
    store.add('2', '2')
    assert.deepEqual(store.getDataSize(), 2)
  })

  it('test for renew interval', () => {
    store.renewInterval(2000)
    assert.deepEqual(store.interval, 2000)
  })

  it('test for output store', () => {
    assert.deepStrictEqual(
      store.outputStore(1000),
      {
        bean: {
          appId: 'appId',
          dataSource: 'sdkType',
          version: 'sdkVersion',
          duration: 2000,
          cacheVersion: 1000,
          data: [
            {
              dataId: '1',
              dataType: '1',
              count: 3
            },
            {
              dataId: '2',
              dataType: '2',
              count: 3
            }
          ]
        }
      }
    )

    assert.deepEqual(store.getDataSize(), 0)
  })
})
