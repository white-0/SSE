const assert = require('assert');
const http = require('http');
const request = require('../');

let p = Promise.resolve();

p = p.then(() => request('http://developer.fx.ctripcorp.com/index.html').then((content) => {
    let testName = 'Offline Empty Option Test';
    assert(typeof content == 'string', testName + ': Invalid Content Type');
    assert(content.indexOf('Developer Center') != -1, testName + ': Invalid Content');
    console.log(testName + ' Passed');
}));

p = p.then(() => request('http://developer.fx.ctripcorp.com/api/qrcode.node.js', {
    contentType: 'json'
}).then((content) => {
    let testName = 'Offline JSON Test';
    assert(typeof content == 'object', testName + ': Invalid Content Type');
    assert(content.message == 'Invalid Url', testName + ': Invalid Content');
    console.log(testName + ' Passed');
}));

p = p.then(() => request('https://m.ctrip.com/html5/', {
    contentType: 'response',
    gzip: true
}).then((content) => {
    let testName = 'Online Gzip Test';
    assert(typeof content == 'object', testName + ': Invalid Content Type');
    assert(content instanceof http.IncomingMessage, testName + ': Invalid Response');
    assert(content.headers['content-encoding'] == 'gzip', testName + ': Invalid Content Encoding');
    assert(content.body.toString().indexOf('携程旅行网是中国领先的在线旅行服务公司') != -1, testName + ': Invalid Content');
    console.log(testName + ' Passed');
}));

p = p.then(() => request('https://www.google.com/', {
    proxy: true
}).then((content) => {
    let testName = 'Proxy Test';
    assert(typeof content == 'string', testName + ': Invalid Content Type');
    assert(content.indexOf('<title>Google</title>') != -1, testName + ': Invalid Content');
    console.log(testName + ' Passed');
}));

p.then(() => {
        console.log('All Tests Passed');
    })
    .catch((err) => {
        console.error(err);
        process.exit(1);
    });