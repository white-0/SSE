const appConfig = require('@ctrip/node-vampire-appconfig');
const util = require('@ctrip/node-vampire-util');
const os = require('os');
const fs = require('fs');
const extra = require('fs-extra');
const platform = os.platform();
const id = parseInt(process.env[process.env.instance_var || 'NODE_APP_INSTANCE'], 10) || 0
let filename = `/opt/logs/${appConfig['appId']}/catLog.log`;

function fsExtra() {
    return extra.ensureFile(filename)
        .then(() => {
            return;
        })
        .catch(err => {
            throw err;
        })
}

function log(message) {
    if (platform == "linux") {
        fsExtra().then(() => {
            fs.appendFile(filename, `[${util.formatDateTime()}-${id}]: ` + message + '\r\n', function (err) {
                err && console.log(err);
            });
        }).catch((err) => {
            console.error(err)
        })
    }
}

module.exports = log;