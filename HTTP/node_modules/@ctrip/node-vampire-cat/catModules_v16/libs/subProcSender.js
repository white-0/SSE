const fs = require("fs");
const queue = require(process.argv[3]);
let queueFile = process.argv[2];
if (queueFile) {
  let queueLength = queue.loadFromDisk(queueFile);
  if (queueLength) {
    console.log("[ Vampire-CAT ] Load Queue Length:", queueLength);

    let clock = setTimeout(function () {
      process.exit(1);
    }, 10000);

    queue.on("idle", function () {
      try {
        fs.unlinkSync(queueFile);
      } catch (e) {
        // empty
      }
      clearTimeout(clock);
      console.log("[ Vampire-CAT ] All Task Finish");
      setTimeout(function () {
        process.exit(0);
      }, 1000);
    });

    require("./sender.js");
  } else {
    process.exit(1);
  }
}
