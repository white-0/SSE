'use strict'
const is = require('is-type-of')
const SharkContext = require('./shark-context')

module.exports = function * (next) {
  if (!this.req || !this.res) {
    throw new Error('koa invalid')
  }

  this.shark = this.req.shark = new SharkContext(this.req, this.res, this.req.cargo || this.cargo)

  if (is.isGeneratorFunction(next)) {
    yield next
  }
}
