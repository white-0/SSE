'use strict'
const is = require('is-type-of')
const SharkContext = require('./shark-context')

module.exports = (ctx, next) => new Promise((resolve, reject) => {
  if (!ctx || !ctx.req || !ctx.res) {
    throw new Error('koa2 invalid')
  }

  ctx.shark = ctx.req.shark = new SharkContext(ctx.req, ctx.res, ctx.req.cargo || ctx.cargo)

  return is.isFunction(next)
    ? resolve(next())
    : resolve(true)
})
