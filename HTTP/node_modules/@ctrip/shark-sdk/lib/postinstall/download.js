const is = require('is-type-of')
const handleFile = require('./file')
const { INTERVALS } = require('../common/constants')

module.exports = _appID => {
  const appIDList = (is.isArray(_appID) ? _appID : [_appID]).filter(appID => /^\d+$/.test(appID.toString()))

  if (!appIDList.length) {
    console.log('[SHARK-SDK POSTINSTALL] No appID')
    return Promise.resolve()
  }

  return Promise.allSettled(
    appIDList
      .map(appID => {
        const fileUrl = INTERVALS.SOURCE_URL.SHA.replace(/%s.zip$/, `${appID}.zip`)
        console.log(`[SHARK-SDK POSTINSTALL] download ${appID} ${fileUrl}`)
        return handleFile(appID, fileUrl)
      }))
}
