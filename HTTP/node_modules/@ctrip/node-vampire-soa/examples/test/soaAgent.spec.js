process.mainModule = {filename: __filename};
const SoaAgent = require('../../soaAgent');
const assert = require('assert');

describe('SoaAgent 测试用例', () => {

    let soaAgent

    before(async () => {
        soaAgent = SoaAgent("12963")
    })

    it('SoaAgent 应用访问测试', (Done) => {
        try {
            soaList(soaAgent, (pms) => {
                Promise.all(pms).then(function () {
                    Done()
                }).catch(function (e) {
                    Done()
                })
            })
        } catch (err) {
            assert.throws(() => {
            }, {}, err)
        }
    })
})

function soaList(soaAgent, callback) {
    let pms = []
    pms.push(soaAgent.invoke('getFlightHotcity', {searchType: 4}).then(function (result) {
        console.log('[getFlightHotcity 4] Response: ', JSON.stringify(result.hotList[0]));
    }).catch(function (e) {
        console.log('[getFlightHotcity 4] Error: ', e);
    }))

    pms.push(soaAgent.invoke('getFlightHotcity', {searchType: 2}).then(function (result) {
        console.log('[getFlightHotcity 2] Response: ', JSON.stringify(result.hotList[0]));
    }).catch(function (e) {
        console.log('[getFlightHotcity 2] Error: ', e);
    }))

    pms.push(soaAgent.invoke('getFlightHotcity', {searchType: 2}, false, {hello: 'world'}).then(function (result) {
        console.log('[getFlightHotcity 3] Response: ', JSON.stringify(result.hotList[0]));
    }).catch(function (e) {
        console.log('[getFlightHotcity 3] Error: ', e);
    }))
    callback(pms)
}
